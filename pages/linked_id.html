<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ê´€ ì½”ë“œ ìë™í™” ì‹œìŠ¤í…œ (ì—‘ì…€ ë‹¤ìš´ë¡œë“œ í¬í•¨)</title>
    
    <!-- ì—‘ì…€ ê¸°ëŠ¥ì„ ìœ„í•œ SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ (CDN) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            padding-top: 40px;
        }

        .container {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 950px;
            display: flex;
            gap: 25px;
            height: 85vh;
        }

        .left-panel {
            flex: 0.8;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #eee;
            padding-right: 20px;
        }

        .right-panel {
            flex: 1.2;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        h2 { margin: 0 0 1rem 0; color: #333; font-size: 1.3rem; }

        /* í—¤ë” ì˜ì—­ (ì œëª© + ë‹¤ìš´ë¡œë“œ ë²„íŠ¼) */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0 5px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #f0f2f5;
        }

        .panel-header h3 {
            font-size: 1rem;
            margin: 0;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-excel {
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .btn-excel:hover { background-color: #218838; }
        .btn-excel:disabled { background-color: #ccc; cursor: not-allowed; }

        label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: bold;
            color: #555;
            font-size: 0.9rem;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 14px;
            margin-bottom: 1rem;
        }

        textarea {
            width: 100%;
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            resize: none;
            font-family: monospace;
            font-size: 11px;
            white-space: pre;
            margin-bottom: 10px;
            min-height: 150px;
        }

        button.main-btn {
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: background 0.2s;
        }

        .btn-extract {
            background-color: #6c757d;
            color: white;
            width: 100%;
            margin-bottom: 20px;
        }
        .btn-extract:hover { background-color: #5a6268; }

        .btn-next {
            background-color: #007bff;
            color: white;
            width: 100%;
            height: 50px;
            font-size: 1.1rem;
        }
        .btn-next:hover { background-color: #0056b3; }
        .btn-next:disabled { background-color: #ccc; cursor: not-allowed; }

        .list-wrapper {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 6px;
            background-color: #fafafa;
            margin-bottom: 10px;
            padding: 5px;
        }

        .list-wrapper.excluded {
            flex: 0.5;
            background-color: #f8f9fa;
            border-color: #ddd;
        }

        .code-item {
            padding: 6px 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            background: white;
            margin-bottom: 2px;
            border-radius: 4px;
            font-size: 13px;
        }

        .code-item.current {
            background-color: #e7f1ff;
            border: 1px solid #007bff;
        }

        .code-item.done {
            color: #aaa;
            text-decoration: line-through;
            background-color: #f9f9f9;
        }

        .idx { width: 30px; color: #888; font-size: 11px; }
        .code { width: 60px; font-weight: bold; color: #007bff; }
        .name { flex: 1; font-weight: bold; color: #333; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .status { width: 50px; text-align: right; font-size: 11px; }
        
        .excluded .status { color: #d9534f; font-weight: bold; }
        .badge {
            background: #6c757d;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
        }
        .badge.active { background: #007bff; }
    </style>
</head>
<body>

    <div class="container">
        <!-- ì™¼ìª½ íŒ¨ë„ -->
        <div class="left-panel">
            <h2>ì„¤ì • ë° ë°ì´í„° ì…ë ¥</h2>
            
            <label for="baseUrl">ê¸°ë³¸ ì£¼ì†Œ (URL)</label>
            <input type="text" id="baseUrl" placeholder="ì˜ˆ: mysite.com">

            <label for="pasteArea">ë°ì´í„° ë¶™ì—¬ë„£ê¸° (ì—‘ì…€ ì „ì²´)</label>
            <textarea id="pasteArea" placeholder="[ë°ì´í„° êµ¬ì¡°]&#13;&#10;2ì—´: ì½”ë“œ, 3ì—´: ê¸°ê´€ëª…, 10ì—´: ê³µê°œ/ë¹„ê³µê°œ&#13;&#10;&#13;&#10;ìœ„ í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
            
            <button class="main-btn btn-extract" onclick="extractCodes()">ëª©ë¡ ì¶”ì¶œí•˜ê¸°</button>

            <div style="margin-top: auto;">
                <label>ì‹¤í–‰ ì»¨íŠ¸ë¡¤</label>
                <button id="nextBtn" class="main-btn btn-next" onclick="openNext()" disabled>ëª©ë¡ ì¶”ì¶œ í•„ìš”</button>
                <p style="font-size:0.8rem; color:#888; margin-top:5px; text-align: center;">* 'ê³µê°œ' í•­ëª©ë§Œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
        <div class="right-panel">
            <!-- ì‹¤í–‰ ëª©ë¡ í—¤ë” -->
            <div class="panel-header">
                <h3>ì‹¤í–‰ ëª©ë¡ (ê³µê°œ) <span class="badge active" id="activeCount">0</span></h3>
                <button class="btn-excel" onclick="downloadExcel('active')" id="btnDownActive" disabled>
                    ğŸ“¥ ì—‘ì…€ ì €ì¥
                </button>
            </div>
            <div class="list-wrapper" id="activeList">
                <div style="padding:20px; text-align:center; color:#ccc;">ë°ì´í„° ì—†ìŒ</div>
            </div>

            <!-- í™•ì¸ìš© ëª©ë¡ í—¤ë” -->
            <div class="panel-header">
                <h3>í™•ì¸ìš© (ë¹„ê³µê°œ/ì œì™¸) <span class="badge" id="excludedCount">0</span></h3>
                <button class="btn-excel" onclick="downloadExcel('excluded')" id="btnDownExcluded" disabled>
                    ğŸ“¥ ì—‘ì…€ ì €ì¥
                </button>
            </div>
            <div class="list-wrapper excluded" id="excludedList">
                <div style="padding:10px; text-align:center; color:#bbb; font-size: 12px;">ë°ì´í„° ì—†ìŒ</div>
            </div>
        </div>
    </div>

    <script>
        const baseUrlInput = document.getElementById('baseUrl');
        const pasteArea = document.getElementById('pasteArea');
        const activeListEl = document.getElementById('activeList');
        const excludedListEl = document.getElementById('excludedList');
        const nextBtn = document.getElementById('nextBtn');
        const activeCountEl = document.getElementById('activeCount');
        const excludedCountEl = document.getElementById('excludedCount');
        const btnDownActive = document.getElementById('btnDownActive');
        const btnDownExcluded = document.getElementById('btnDownExcluded');

        // ë°ì´í„°ë¥¼ ì €ì¥í•  ë°°ì—´ (ì—‘ì…€ ë‹¤ìš´ë¡œë“œìš©)
        let activeDataList = [];   // ì‹¤í–‰ ëª©ë¡ ë°ì´í„°
        let excludedDataList = []; // ì œì™¸ ëª©ë¡ ë°ì´í„°
        
        let currentIndex = 0; // í˜„ì¬ ì‹¤í–‰ ìˆœì„œ

        function extractCodes() {
            const rawText = pasteArea.value.trim();
            if (!rawText) {
                alert("ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            const lines = rawText.split('\n');
            
            // ì´ˆê¸°í™”
            activeDataList = [];
            excludedDataList = [];
            currentIndex = 0;
            activeListEl.innerHTML = '';
            excludedListEl.innerHTML = '';
            
            lines.forEach((line, index) => {
                line = line.trim();
                if(!line) return;

                // íƒ­(\t) ìš°ì„  ë¶„ë¦¬, ì‹¤íŒ¨ ì‹œ ê³µë°± ë¶„ë¦¬
                let columns = line.split('\t');
                if (columns.length < 2) {
                    columns = line.split(/\s+/);
                }

                // ë°ì´í„° íŒŒì‹±
                // 2ì—´(idx 1): ì½”ë“œ, 3ì—´(idx 2): ê¸°ê´€ëª…, 10ì—´(idx 9): ìƒíƒœ
                if (columns.length >= 10) {
                    const code = columns[1].trim();
                    const name = columns[2].trim();
                    const status = columns[9].trim();

                    const dataItem = { code, name, status };

                    if (status === 'ê³µê°œ') {
                        // ì‹¤í–‰ ëª©ë¡ ì¶”ê°€
                        activeDataList.push(dataItem);
                        
                        const div = document.createElement('div');
                        div.className = 'code-item';
                        div.id = 'todo-' + (activeDataList.length - 1);
                        div.innerHTML = `
                            <span class="idx">#${activeDataList.length}</span>
                            <span class="code">${code}</span>
                            <span class="name">${name}</span>
                            <span class="status" style="color:#28a745;">${status}</span>
                        `;
                        activeListEl.appendChild(div);

                    } else {
                        // ì œì™¸ ëª©ë¡ ì¶”ê°€
                        excludedDataList.push(dataItem);

                        const div = document.createElement('div');
                        div.className = 'code-item';
                        div.innerHTML = `
                            <span class="idx">-</span>
                            <span class="code">${code}</span>
                            <span class="name">${name}</span>
                            <span class="status">${status}</span>
                        `;
                        excludedListEl.appendChild(div);
                    }
                }
            });

            // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            activeCountEl.innerText = activeDataList.length;
            excludedCountEl.innerText = excludedDataList.length;

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            if (activeDataList.length > 0) {
                nextBtn.disabled = false;
                btnDownActive.disabled = false;
                updateNextButtonState();
                highlightItem(0);
            } else {
                nextBtn.disabled = true;
                nextBtn.innerText = "ì‹¤í–‰í•  ë°ì´í„° ì—†ìŒ";
                btnDownActive.disabled = true;
            }

            if (excludedDataList.length > 0) {
                btnDownExcluded.disabled = false;
            } else {
                btnDownExcluded.disabled = true;
            }
        }

        function openNext() {
            if (currentIndex >= activeDataList.length) {
                alert("ëª¨ë“  ëª©ë¡ì„ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.");
                return;
            }

            const item = activeDataList[currentIndex];
            let baseUrl = baseUrlInput.value.trim();

            if (!baseUrl) {
                alert("ê¸°ë³¸ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                baseUrlInput.focus();
                return;
            }

            if (!baseUrl.startsWith('http://') && !baseUrl.startsWith('https://')) {
                baseUrl = 'https://' + baseUrl;
            }

            let finalUrl;
            if (baseUrl.endsWith('/')) {
                finalUrl = baseUrl + item.code;
            } else {
                finalUrl = baseUrl + '/' + item.code;
            }

            window.open(finalUrl, '_blank');
            markAsDone(currentIndex);
            currentIndex++;
            updateNextButtonState();
        }

        function updateNextButtonState() {
            if (currentIndex < activeDataList.length) {
                const nextItem = activeDataList[currentIndex];
                nextBtn.innerText = `ë‹¤ìŒ: ${nextItem.name} (${nextItem.code})`;
                highlightItem(currentIndex);
                
                const el = document.getElementById('todo-' + currentIndex);
                if(el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                nextBtn.innerText = "ëª¨ë‘ ì™„ë£Œë¨";
                nextBtn.disabled = true;
            }
        }

        function highlightItem(index) {
            document.querySelectorAll('.code-item.current').forEach(el => el.classList.remove('current'));
            const target = document.getElementById('todo-' + index);
            if (target) target.classList.add('current');
        }

        function markAsDone(index) {
            const target = document.getElementById('todo-' + index);
            if (target) {
                target.classList.remove('current');
                target.classList.add('done');
            }
        }

        // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ (SheetJS ì‚¬ìš©)
        function downloadExcel(type) {
            let data, filename;
            
            if (type === 'active') {
                data = activeDataList;
                filename = "ì‹¤í–‰ëª©ë¡_ê³µê°œ.xlsx";
            } else {
                data = excludedDataList;
                filename = "ì œì™¸ëª©ë¡_ë¹„ê³µê°œ.xlsx";
            }

            if (data.length === 0) {
                alert("ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // 1. JSON ë°ì´í„°ë¥¼ ì—‘ì…€ìš© ì‹œíŠ¸ë¡œ ë³€í™˜ (í—¤ë” í•œê¸€í™” ë§¤í•‘)
            const excelData = data.map(item => ({
                'ê¸°ê´€ì½”ë“œ': item.code,
                'ê¸°ê´€ëª…': item.name,
                'ìƒíƒœ': item.status
            }));

            // 2. ì›Œí¬ë¶ ìƒì„±
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelData);

            // 3. ì—´ ë„ˆë¹„ ì¡°ì • (ì„ íƒ ì‚¬í•­)
            ws['!cols'] = [
                { wch: 15 }, // ê¸°ê´€ì½”ë“œ ë„ˆë¹„
                { wch: 30 }, // ê¸°ê´€ëª… ë„ˆë¹„
                { wch: 10 }  // ìƒíƒœ ë„ˆë¹„
            ];

            // 4. ì‹œíŠ¸ ì¶”ê°€ ë° íŒŒì¼ ì €ì¥
            XLSX.utils.book_append_sheet(wb, ws, "ëª©ë¡");
            XLSX.writeFile(wb, filename);
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                if (document.activeElement !== pasteArea && document.activeElement !== baseUrlInput && !nextBtn.disabled) {
                    openNext();
                }
            }
        });
    </script>
</body>
</html>
